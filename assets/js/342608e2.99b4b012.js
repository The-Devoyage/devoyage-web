"use strict";(self.webpackChunkdevoyage_web=self.webpackChunkdevoyage_web||[]).push([[9255],{4222:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>l,frontMatter:()=>t,metadata:()=>o,toc:()=>u});var a=s(4848),i=s(8453);const t={id:"examples-guards",title:"Guards"},r=void 0,o={id:"examples/examples-guards",title:"Guards",description:"",source:"@site/subgraph/12-examples/11-guards.md",sourceDirName:"12-examples",slug:"/examples/examples-guards",permalink:"/subgraph/examples/examples-guards",draft:!1,unlisted:!1,editUrl:"https://www.github.com/The-Devoyage/devoyage-web/blob/master/subgraph/12-examples/11-guards.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{id:"examples-guards",title:"Guards"},sidebar:"subgraphSidebar",previous:{title:"Extending Entities/Associations",permalink:"/subgraph/examples/examples-associations"},next:{title:"WebAuthN & Auth API",permalink:"/subgraph/examples/examples-webauthn-auth"}},d={},u=[];function c(e){const n={code:"code",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-toml",children:'[service]\nname = "espresso"\nport = 3030\nlog_level = "debug"\n\n# If the `Authorization` header does not have the value "12345", then deny access.\n# Escape strings when using inline definitions.\n[[service.guards]]\nname = "invalid_access_key"\nif_expr = "headers(\\"Authorization\\") != \\"12345\\""\nthen_msg = "Invalid Access Key - Permission Denied"\n\n# If the `role` header does not have the value of "admin", then deny access.\n[[service.guards]]\nname = "invalid_role"\nif_expr = "headers(\\"role\\") != \\"admin\\""\nthen_msg = "Invalid Role - Permission Denied"\n\n[[service.data_sources]]\n[service.data_sources.SQL]\nname = "caffeine_data_source"\nuri = "sqlite:/home/nickisyourfan/Desktop/DEV/dbs/caffeine.db"\ndialect = "SQLITE"\n[[service.data_sources]]\n[service.data_sources.Mongo]\nname = "beers_ds"\nuri = "mongodb://sun:sun@127.0.0.1:27017/sun"\ndb = "sun"\n\n[[service.entities]]\nname = "Espresso"\n\n[[service.entities.guards]]\nname = "invalid_name"\n# If the user searches by anything other than "nick" for the `name` property, then deny access.\n# The input function returns an array, so make sure to use an array method to evaluate the expression.\nif_expr = "!contains(input(\\"query\\" \\"name\\"), \\"nick\\")"\nthen_msg = "Invalid Name - Permission Denied"\n\n[service.entities.data_source]\nfrom = "caffeine_data_source"\n[service.entities.data_source.resolvers]\n[service.entities.data_source.resolvers.find_one]\n[[service.entities.data_source.resolvers.find_one.guards]]\nname = "invalid_age"\n# No need to escape strings with multi line definitions.\nif_expr = \'\'\'\n    token_data("user_uuid") != "abcdefg"\n\'\'\'\nthen_msg = "Permission Denied"\n\n[[service.entities.fields]]\nname = "id"\nscalar = "Int"\nrequired = true\nexclude_from_input = ["CreateOne", "UpdateOne", "UpdateMany"]\n[[service.entities.fields]]\nname = "name"\nscalar = "String"\nrequired = true\nguards = [\n  {name = "id", if_expr = "headers(\\"role\\") != \\"admin\\"", then_msg = "Invalid Access - Field Level" },\n]\n[[service.entities.fields]]\nname = "price"\nscalar = "Int"\nrequired = true\nlist = false\nguards = [\n  {name = "price", if_expr = "headers(\\"user_id\\") != 1", then_msg = "Access Denied - You do not have permission." },\n]\n[[service.entities.fields]]\nname = "available"\nscalar = "Boolean"\nrequired = true\n'})})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var a=s(6540);const i={},t=a.createContext(i);function r(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);