"use strict";(self.webpackChunkdevoyage_web=self.webpackChunkdevoyage_web||[]).push([[734],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=r.createContext({}),l=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(u.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(n),d=a,y=p["".concat(u,".").concat(d)]||p[d]||h[d]||o;return n?r.createElement(y,i(i({ref:t},c),{},{components:n})):r.createElement(y,i({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=p;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},7056:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const o={id:"authorize-requests",title:"Authorize Requests"},i=void 0,s={unversionedId:"usage/authorize-requests",id:"usage/authorize-requests",title:"Authorize Requests",description:"Once you have your server up and running, you can now start to send requests. Each request sent to the server is automatically provided with an authorization status which can be used throughout the Federated API.",source:"@site/gateway/04-usage/01-authorize-requests.md",sourceDirName:"04-usage",slug:"/usage/authorize-requests",permalink:"/gateway/usage/authorize-requests",draft:!1,editUrl:"https://www.github.com/The-Devoyage/devoyage-web/blob/master/gateway/04-usage/01-authorize-requests.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"authorize-requests",title:"Authorize Requests"},sidebar:"gatewaySidebar",previous:{title:"Setting Up The Gateway",permalink:"/gateway/setup"},next:{title:"File Uploading",permalink:"/gateway/usage/file-uploads"}},u={},l=[{value:"The Status Object",id:"the-status-object",level:2},{value:"Authorized Requests",id:"authorized-requests",level:2},{value:"The Token",id:"the-token",level:2},{value:"Access The Authorization Status",id:"access-the-authorization-status",level:2}],c={toc:l};function h(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Once you have your server up and running, you can now start to send requests. Each request sent to the server is automatically provided with an authorization status which can be used throughout the Federated API."),(0,a.kt)("h2",{id:"the-status-object"},"The Status Object"),(0,a.kt)("p",null,"All requests which travel through the gateway are provided with the useful ",(0,a.kt)("inlineCode",{parentName:"p"},"auth")," context including the authorization status itself (",(0,a.kt)("inlineCode",{parentName:"p"},"isAuth"),"), and the token payload."),(0,a.kt)("p",null,"Notice the ",(0,a.kt)("inlineCode",{parentName:"p"},"account")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"user")," properties. If your token stores data that matches these properties, it will automatically populate the data within the context."),(0,a.kt)("p",null,"Any additional data from the JWT is also automatically added to the payload property of the ",(0,a.kt)("inlineCode",{parentName:"p"},"AuthContext")," object."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"interface AuthContext {\n  payload: {\n    account: { _id: string; email: string } | null;\n    user: { _id: string; role: number; email: string } | null;\n    // ...custom token data\n  };\n  isAuth: boolean;\n}\n")),(0,a.kt)("h2",{id:"authorized-requests"},"Authorized Requests"),(0,a.kt)("p",null,"To create an authorized request, you must provide a little bit of configuration in addition to the JWT itself."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"When setting up the environment variables of the service, you must provide the ",(0,a.kt)("inlineCode",{parentName:"li"},"JWT_ENCRYPTION_KEY")," property. Use the same key that encrypted the token it is also possible to use a public decryption key."),(0,a.kt)("li",{parentName:"ol"},"When sending requests, include the JWT inside the ",(0,a.kt)("inlineCode",{parentName:"li"},"Authorization")," header of the request.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Authorization: Bearer $TOKEN\n")),(0,a.kt)("p",null,"That's it! You don't have to configure anything else. The server is now smart enough to authorize request with valid tokens."),(0,a.kt)("h2",{id:"the-token"},"The Token"),(0,a.kt)("p",null,"While this service does not provide methods to create JWTs, you can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"@the-devoyage/micro-auth-helpers")," library to easily create tokens for this service. In addition, this service also uses the same library to verify and decrypt the token."),(0,a.kt)("h2",{id:"access-the-authorization-status"},"Access The Authorization Status"),(0,a.kt)("p",null,"From within the external connected Federated Service, the authorization status is available from within the context object inside a Resolver."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'// External/Custom Accounts Service\n\ngetMyAccount: async (_parent, _args, context) => {\n  const authContext = context.auth;\n\n  if (!authContext.isAuth) {\n    throw new Error("NOT AUTHENTICATED!");\n  }\n\n  // ...get account logic\n};\n')))}h.isMDXComponent=!0}}]);